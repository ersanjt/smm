(function(t){var a=[],e=[],n=[];t.fn.addTag=function(i,o){return o=jQuery.extend({focus:!1,callback:!0},o),this.each(function(){var s=t(this).attr("id"),l=t(this).val().split(r(a[s]));if(""===l[0]&&(l=[]),i=jQuery.trim(i),e[s].unique&&t(this).tagExist(i)||!u(i,e[s],l,a[s]))return t("#"+s+"_tag").addClass("error"),!1;if(t("<span>",{class:"tag"}).append(t("<span>",{class:"tag-text"}).text(i),t("<button>",{class:"tag-remove"}).click(function(){return t("#"+s).removeTag(encodeURI(i))})).insertBefore("#"+s+"_addTag"),l.push(i),t("#"+s+"_tag").val(""),o.focus?t("#"+s+"_tag").focus():t("#"+s+"_tag").blur(),t.fn.tagsInput.updateTagsField(this,l),o.callback&&n[s]&&n[s].onAddTag){var d=n[s].onAddTag;d.call(this,this,i)}if(n[s]&&n[s].onChange){l.length,d=n[s].onChange;d.call(this,this,i)}}),!1},t.fn.removeTag=function(e){return e=decodeURI(e),this.each(function(){var u=t(this).attr("id"),o=t(this).val().split(r(a[u]));t("#"+u+"_tagsinput .tag").remove();var s="";for(i=0;i<o.length;++i)o[i]!=e&&(s=s+r(a[u])+o[i]);if(t.fn.tagsInput.importTags(this,s),n[u]&&n[u].onRemoveTag){var l=n[u].onRemoveTag;l.call(this,this,e)}}),!1},t.fn.tagExist=function(i){var e=t(this).attr("id"),n=t(this).val().split(r(a[e]));return jQuery.inArray(i,n)>=0},t.fn.importTags=function(a){var i=t(this).attr("id");t("#"+i+"_tagsinput .tag").remove(),t.fn.tagsInput.importTags(this,a)},t.fn.tagsInput=function(i){var u=jQuery.extend({interactive:!0,placeholder:"Add a tag",minChars:0,maxChars:null,limit:null,validationPattern:null,width:"auto",height:"auto",autocomplete:null,hide:!0,delimiter:",",unique:!0,removeWithBackspace:!1},i),l=0;return this.each(function(){if(void 0===t(this).data("tagsinput-init")){t(this).data("tagsinput-init",!0),u.hide&&t(this).hide();var i=t(this).attr("id");i&&!r(a[t(this).attr("id")])||(i=t(this).attr("id","tags"+(new Date).getTime()+ ++l).attr("id"));var d=jQuery.extend({pid:i,real_input:"#"+i,holder:"#"+i+"_tagsinput",input_wrapper:"#"+i+"_addTag",fake_input:"#"+i+"_tag"},u);a[i]=d.delimiter,e[i]={minChars:u.minChars,maxChars:u.maxChars,limit:u.limit,validationPattern:u.validationPattern,unique:u.unique},(u.onAddTag||u.onRemoveTag||u.onChange)&&(n[i]=[],n[i].onAddTag=u.onAddTag,n[i].onRemoveTag=u.onRemoveTag,n[i].onChange=u.onChange);var h=t("<div>",{id:i+"_tagsinput",class:"tagsinput form-control"}).append(t("<div>",{id:i+"_addTag"}).append(u.interactive?t("<input>",{id:i+"_tag",class:"tag-input form-control",value:"",placeholder:u.placeholder}):null));t(h).insertAfter(this),t(d.holder).css("width",u.width),t(d.holder).css("min-height",u.height),t(d.holder).css("height",u.height),""!==t(d.real_input).val()&&t.fn.tagsInput.importTags(t(d.real_input),t(d.real_input).val()),u.interactive&&(t(d.fake_input).val(""),t(d.fake_input).data("pasted",!1),t(d.fake_input).on("focus",d,function(a){t(d.holder).addClass("focus"),""===t(this).val()&&t(this).removeClass("error")}),t(d.fake_input).on("blur",d,function(a){t(d.holder).removeClass("focus")}),null!==u.autocomplete&&void 0!==jQuery.ui.autocomplete?(t(d.fake_input).autocomplete(u.autocomplete),t(d.fake_input).on("autocompleteselect",d,function(a,i){return t(a.data.real_input).addTag(i.item.value,{focus:!0,unique:u.unique}),!1}),t(d.fake_input).on("keypress",d,function(a){o(a)&&t(this).autocomplete("close")})):t(d.fake_input).on("blur",d,function(a){return t(a.data.real_input).addTag(t(a.data.fake_input).val(),{focus:!0,unique:u.unique}),!1}),t(d.fake_input).on("keypress",d,function(a){if(o(a))return a.preventDefault(),t(a.data.real_input).addTag(t(a.data.fake_input).val(),{focus:!0,unique:u.unique}),!1}),t(d.fake_input).on("paste",function(){t(this).data("pasted",!0)}),t(d.fake_input).on("input",d,function(a){if(t(this).data("pasted")){t(this).data("pasted",!1);var i=t(a.data.fake_input).val();i=i.replace(/\n/g,""),i=i.replace(/\s/g,"");var e=s(a.data.delimiter,i);if(e.length>1){for(var n=0;n<e.length;++n)t(a.data.real_input).addTag(e[n],{focus:!0,unique:u.unique});return!1}}}),d.removeWithBackspace&&t(d.fake_input).on("keydown",function(a){if(8==a.keyCode&&""===t(this).val()){a.preventDefault();var i=t(this).closest(".tagsinput").find(".tag:last > span").text(),e=t(this).attr("id").replace(/_tag$/,"");t("#"+e).removeTag(encodeURI(i)),t(this).trigger("focus")}}),t(d.fake_input).keydown(function(a){-1===jQuery.inArray(a.keyCode,[13,37,38,39,40,27,16,17,18,225])&&t(this).removeClass("error")}))}}),this},t.fn.tagsInput.updateTagsField=function(i,e){var n=t(i).attr("id");t(i).val(e.join(r(a[n])))},t.fn.tagsInput.importTags=function(e,r){t(e).val("");var u=t(e).attr("id"),o=s(a[u],r);for(i=0;i<o.length;++i)t(e).addTag(o[i],{focus:!1,callback:!1});if(n[u]&&n[u].onChange){var l=n[u].onChange;l.call(e,e,o)}};var r=function(t){return void 0===t?t:"string"==typeof t?t:t[0]},u=function(a,i,e,n){var r=!0;return""===a&&(r=!1),a.length<i.minChars&&(r=!1),null!==i.maxChars&&a.length>i.maxChars&&(r=!1),null!==i.limit&&e.length>=i.limit&&(r=!1),null===i.validationPattern||i.validationPattern.test(a)||(r=!1),"string"==typeof n?a.indexOf(n)>-1&&(r=!1):t.each(n,function(t,i){return a.indexOf(i)>-1&&(r=!1),!1}),r},o=function(a){var i=!1;return 13===a.which||("string"==typeof a.data.delimiter?a.which===a.data.delimiter.charCodeAt(0)&&(i=!0):t.each(a.data.delimiter,function(t,e){a.which===e.charCodeAt(0)&&(i=!0)}),i)},s=function(a,i){if(""===i)return[];if("string"==typeof a)return i.split(a);var e="âˆž",n=i;return t.each(a,function(t,a){n=n.split(a).join(e)}),n.split(e)}})(jQuery);